# NPM è„šæœ¬å‘½ä»¤è¯´æ˜

## æ¦‚è¿°

é¡¹ç›®ä¸­æ·»åŠ äº†å¤šä¸ª npm è„šæœ¬å‘½ä»¤æ¥ç®€åŒ–å¼€å‘å’Œç»´æŠ¤å·¥ä½œï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ changelog çš„éªŒè¯å’Œæµ‹è¯•ã€‚

## åŸºç¡€å‘½ä»¤

### å¼€å‘å’Œæ„å»º

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–
npm run lint
```

## Changelog ç›¸å…³å‘½ä»¤

### 1. æ ¼å¼éªŒè¯

```bash
npm run changelog:validate
```

**åŠŸèƒ½ï¼š**
- éªŒè¯ `CHANGELOG.md` å’Œ `CHANGELOG.zh.md` çš„æ ¼å¼
- æ£€æŸ¥æ˜¯å¦ç¬¦åˆ Keep a Changelog è§„èŒƒ
- éªŒè¯ç‰ˆæœ¬å·æ ¼å¼ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰
- éªŒè¯æ—¥æœŸæ ¼å¼ï¼ˆYYYY-MM-DDï¼‰
- æ£€æŸ¥å˜æ›´ç±»å‹æ˜¯å¦æœ‰æ•ˆ

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ” éªŒè¯ Changelog æ–‡ä»¶æ ¼å¼...

éªŒè¯ CHANGELOG.md...
âœ… CHANGELOG.md æ ¼å¼éªŒè¯é€šè¿‡ (æ‰¾åˆ° 8 ä¸ªç‰ˆæœ¬)

éªŒè¯ CHANGELOG.zh.md...
âœ… CHANGELOG.zh.md æ ¼å¼éªŒè¯é€šè¿‡ (æ‰¾åˆ° 8 ä¸ªç‰ˆæœ¬)

ğŸ“Š éªŒè¯ç»“æœ:
âœ… æ‰€æœ‰ changelog æ–‡ä»¶æ ¼å¼æ­£ç¡®
```

### 2. è§£æå™¨æµ‹è¯•

```bash
npm run changelog:test
```

**åŠŸèƒ½ï¼š**
- æµ‹è¯• changelog è§£æå™¨çš„åŸºæœ¬åŠŸèƒ½
- ç»Ÿè®¡ç‰ˆæœ¬æ•°é‡ã€å˜æ›´ç±»å‹æ•°é‡ã€å˜æ›´é¡¹æ•°é‡
- éªŒè¯ä¸­æ–‡å˜æ›´ç±»å‹æ˜¯å¦è¢«æ­£ç¡®è¯†åˆ«
- æ£€æŸ¥è§£æå™¨å¯¹ä¸­è‹±æ–‡ changelog çš„å¤„ç†èƒ½åŠ›

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ§ª æµ‹è¯• Changelog è§£æå™¨

ğŸ“„ æµ‹è¯•ä¸­æ–‡ CHANGELOG.zh.md:
  âœ“ æ‰¾åˆ° 8 ä¸ªç‰ˆæœ¬
  âœ“ æ‰¾åˆ° 19 ä¸ªå˜æ›´ç±»å‹
  âœ“ æ‰¾åˆ° 43 ä¸ªå˜æ›´é¡¹

ğŸ“„ æµ‹è¯•è‹±æ–‡ CHANGELOG.md:
  âœ“ æ‰¾åˆ° 8 ä¸ªç‰ˆæœ¬
  âœ“ æ‰¾åˆ° 19 ä¸ªå˜æ›´ç±»å‹
  âœ“ æ‰¾åˆ° 43 ä¸ªå˜æ›´é¡¹

ğŸ” æ£€æŸ¥ä¸­æ–‡å˜æ›´ç±»å‹:
  æ‰¾åˆ°çš„å˜æ›´ç±»å‹: æ–°å¢, å˜æ›´, ä¿®å¤, ç§»é™¤, å·²å¼ƒç”¨
  âœ“ æ‰€æœ‰å˜æ›´ç±»å‹éƒ½æœ‰æ•ˆ

âœ… è§£æå™¨æµ‹è¯•å®Œæˆ
```

### 3. é›†æˆæµ‹è¯•

```bash
npm run changelog:test-integration
```

**åŠŸèƒ½ï¼š**
- æµ‹è¯• changelog è§£æå™¨çš„å®é™…é›†æˆæ•ˆæœ
- æ¨¡æ‹Ÿé¡µé¢ä¸­çš„è§£æé€»è¾‘
- éªŒè¯è§£æåçš„æ•°æ®ç»“æ„
- æ£€æŸ¥æ˜¯å¦æœ‰ç©ºçš„ç‰ˆæœ¬æ¡ç›®

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ğŸ§ª æµ‹è¯•ä¸­æ–‡ Changelog è§£æé›†æˆ

âœ… æˆåŠŸè§£æ 8 ä¸ªç‰ˆæœ¬æ¡ç›®

ğŸ“¦ ç‰ˆæœ¬ æœªå‘å¸ƒ (unreleased)
   æ—¥æœŸ: æœªæŒ‡å®š
   added: 2 é¡¹
   changed: 1 é¡¹

ğŸ“¦ ç‰ˆæœ¬ 2.1.0 (minor)
   æ—¥æœŸ: 2024-12-20
   added: 3 é¡¹
   changed: 2 é¡¹
   fixed: 2 é¡¹

âœ… æ‰€æœ‰ç‰ˆæœ¬æ¡ç›®éƒ½åŒ…å«å˜æ›´å†…å®¹

ğŸ‰ ä¸­æ–‡ Changelog è§£ææµ‹è¯•å®Œæˆï¼
```

### 4. å®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
npm run changelog:test-all
```

**åŠŸèƒ½ï¼š**
- ä¾æ¬¡è¿è¡Œæ‰€æœ‰ changelog ç›¸å…³æµ‹è¯•
- åŒ…å«æ ¼å¼éªŒè¯ã€è§£æå™¨æµ‹è¯•ã€é›†æˆæµ‹è¯•
- æä¾›å®Œæ•´çš„æµ‹è¯•è¦†ç›–

**ç­‰ä»·äºï¼š**
```bash
npm run changelog:validate && npm run changelog:test && npm run changelog:test-integration
```

## ä½¿ç”¨åœºæ™¯

### å¼€å‘æ—¶

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­éªŒè¯ changelog
npm run changelog:validate
```

### æ›´æ–° changelog å

```bash
# 1. ç¼–è¾‘ CHANGELOG.md æˆ– CHANGELOG.zh.md
# 2. éªŒè¯æ ¼å¼
npm run changelog:validate

# 3. æµ‹è¯•è§£æå™¨
npm run changelog:test

# 4. æˆ–è€…è¿è¡Œå®Œæ•´æµ‹è¯•
npm run changelog:test-all
```

### æ„å»ºå‰

```bash
# å®Œæ•´çš„é¢„æ„å»ºæ£€æŸ¥
npm run lint
npm run changelog:test-all
npm run build
```

### CI/CD æµç¨‹

```bash
# åœ¨ CI ä¸­è¿è¡Œçš„å‘½ä»¤
npm ci
npm run lint
npm run changelog:test-all
npm run build
```

## è„šæœ¬æ–‡ä»¶è¯´æ˜

### `scripts/validate-changelog.js`
- **åŠŸèƒ½**ï¼šéªŒè¯ changelog æ–‡ä»¶æ ¼å¼
- **æ£€æŸ¥é¡¹**ï¼šæ ‡é¢˜ã€æè¿°ã€ç‰ˆæœ¬æ ¼å¼ã€æ—¥æœŸæ ¼å¼ã€å˜æ›´ç±»å‹
- **æ”¯æŒ**ï¼šä¸­è‹±æ–‡åŒè¯­

### `scripts/test-changelog-parser.js`
- **åŠŸèƒ½**ï¼šæµ‹è¯•è§£æå™¨åŸºæœ¬åŠŸèƒ½
- **æ£€æŸ¥é¡¹**ï¼šç‰ˆæœ¬æ•°é‡ã€å˜æ›´ç±»å‹æ•°é‡ã€å˜æ›´é¡¹æ•°é‡
- **æ”¯æŒ**ï¼šä¸­è‹±æ–‡å˜æ›´ç±»å‹è¯†åˆ«

### `scripts/test-changelog-integration.js`
- **åŠŸèƒ½**ï¼šæµ‹è¯•è§£æå™¨é›†æˆæ•ˆæœ
- **æ£€æŸ¥é¡¹**ï¼šæ•°æ®ç»“æ„ã€ç©ºæ¡ç›®æ£€æµ‹
- **æ¨¡æ‹Ÿ**ï¼šå®é™…é¡µé¢è§£æé€»è¾‘

## é”™è¯¯å¤„ç†

### æ ¼å¼éªŒè¯å¤±è´¥

```bash
âŒ ç‰ˆæœ¬å·æ ¼å¼å¯èƒ½ä¸æ­£ç¡®: 2.1 (è¡Œ 15)
âš ï¸  æ—¥æœŸæ ¼å¼å¯èƒ½ä¸æ­£ç¡®: 2024/12/20 (è¡Œ 15)
âš ï¸  æœªçŸ¥çš„å˜æ›´ç±»å‹: æ”¹è¿› (è¡Œ 20)
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼ˆX.Y.Zï¼‰
2. ç¡®ä¿æ—¥æœŸæ ¼å¼ä¸º YYYY-MM-DD
3. ä½¿ç”¨æ ‡å‡†çš„å˜æ›´ç±»å‹ï¼ˆæ–°å¢ã€å˜æ›´ã€ä¿®å¤ã€ç§»é™¤ã€å·²å¼ƒç”¨ã€å®‰å…¨ï¼‰

### è§£æå™¨æµ‹è¯•å¤±è´¥

```bash
âš ï¸  å‘ç° 2 ä¸ªç©ºçš„ç‰ˆæœ¬æ¡ç›®:
   - 1.5.0
   - 1.4.0
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç©ºç‰ˆæœ¬æ¡ç›®æ˜¯å¦ç¼ºå°‘å˜æ›´å†…å®¹
2. ç¡®ä¿æ¯ä¸ªç‰ˆæœ¬è‡³å°‘æœ‰ä¸€ä¸ªå˜æ›´ç±»å‹å’Œå˜æ›´é¡¹
3. éªŒè¯ markdown æ ¼å¼æ˜¯å¦æ­£ç¡®

## æœ€ä½³å®è·µ

### 1. å®šæœŸéªŒè¯

```bash
# æ¯æ¬¡æäº¤å‰è¿è¡Œ
npm run changelog:test-all
```

### 2. è‡ªåŠ¨åŒ–æ£€æŸ¥

åœ¨ `package.json` ä¸­æ·»åŠ  pre-commit hookï¼š

```json
{
  "scripts": {
    "precommit": "npm run lint && npm run changelog:validate"
  }
}
```

### 3. ç‰ˆæœ¬å‘å¸ƒæµç¨‹

```bash
# 1. æ›´æ–° changelog
# 2. éªŒè¯æ ¼å¼
npm run changelog:validate

# 3. æµ‹è¯•è§£æ
npm run changelog:test-all

# 4. æ„å»ºå’Œå‘å¸ƒ
npm run build
npm version patch  # æˆ– minor/major
npm publish
```

### 4. å›¢é˜Ÿåä½œ

- æ‰€æœ‰å›¢é˜Ÿæˆå‘˜åœ¨ä¿®æ”¹ changelog åéƒ½åº”è¿è¡ŒéªŒè¯å‘½ä»¤
- åœ¨ PR ä¸­åŒ…å« changelog éªŒè¯ç»“æœ
- è®¾ç½® CI è‡ªåŠ¨è¿è¡Œè¿™äº›æ£€æŸ¥

## æ‰©å±•å»ºè®®

### 1. æ·»åŠ æ›´å¤šæµ‹è¯•

```json
{
  "scripts": {
    "changelog:lint": "markdownlint CHANGELOG*.md",
    "changelog:spell": "cspell CHANGELOG*.md",
    "changelog:links": "markdown-link-check CHANGELOG*.md"
  }
}
```

### 2. è‡ªåŠ¨åŒ–ç”Ÿæˆ

```json
{
  "scripts": {
    "changelog:generate": "conventional-changelog -p angular -i CHANGELOG.md -s",
    "changelog:release": "standard-version"
  }
}
```

### 3. éƒ¨ç½²é›†æˆ

```json
{
  "scripts": {
    "predeploy": "npm run changelog:test-all && npm run build",
    "deploy": "next export && gh-pages -d out"
  }
}
```